<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Jed Rembold">
  <title>Modeling and Transforming</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../html_srcs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../html_srcs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="../html_srcs/revealjs/../css/theme/nord_light.css" id="theme">
  <link rel="stylesheet" href="../html_srcs/revealjs/../css/highlight/nord.css">
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Modeling and Transforming</h1>
  <p class="author">Jed Rembold</p>
  <p class="date">Wednesday, March 1, 2023</p>
</section>

<section id="announcements" class="slide level2">
<h2>Announcements</h2>
<ul>
<li>Homework 6 is due on Sunday
<ul>
<li>Homework 7 should be good to come out by this weekend</li>
</ul></li>
<li>I’ll have a moment to give feedback on the midterms this weekend,
but in general I thought everyone did well</li>
<li>Anyone with PATH issues on running the
<code class="python">psql -f hw6.sql</code> command for the hw?</li>
<li>In class polling: <a
href="http://rembold-class.ddns.net">rembold-class.ddns.net</a></li>
</ul>
</section>
<section id="scripting-prep" class="slide level2">
<h2>Scripting Prep</h2>
<ul>
<li>Next week, I want to introduce how to scrape data from websites or
API</li>
<li>Doing so generally requires some sort of scripting language, and I’m
aware that not everyone in here as experience with a scripting language
(yet)</li>
<li>What I’m playing around with is something as follows:
<ul>
<li>Providing simple scripts in different languages that will scrape a
website for tables or access an API at a given URL, and return a JSON
structure of the resulting data</li>
<li>Introduce the functionality Postgres has for natively working with
JSON data</li>
</ul></li>
<li>I think this will provide the necessary flexibility for what you’ll
need later, as well as introducing something I haven’t covered in the
past that I think is quite useful to know</li>
</ul>
<!--------  Scraping ------------------>
<!--
## Webscraping
- Webscraping is the act of extracting information from a webpage so that it can be collected or otherwise used elsewhere
- It can take multiple forms, with varying degrees of complexity (most of which depends on the website)
  - Extracting information from a table of data
  - Extracting other information on a webpage that in not necessarily formatted
  - Extracting information using a provided API endpoint
- Our goal today is to touch on how you could do each of these in R
  - In R we'll be using `rvest` (with comes as part of tidyverse) and `jsonlite`


## Step 1: Get the HTML
- Regardless of what language you are using to scrape a website, the first step is to grab the necessary html
- This is exactly what your browser is doing when it accesses a webpage
- You can only scrape what is made available as part of a page's html.
  - Many modern webpages use Javascript to tweak or modify aspects of the html on a page. Basic webscraping will not work for these sites, unfortunately.
- In R, this is done using the `read_html` function:
```R
html <- read_html(url)
```

## Step 2: Understanding Tags
- HTML is comprised by information stored within what are called _tags_
  - Tags can also be nested inside other tags
- Extracting information from a webpage is frequently about knowing which tags have the information you want
- Take advantage of the "Inspect" tool on most browsers, accessed by right-clicking on a web page
  - Will give you the option to explore both the html and mouse around the webpage and highlight the corresponding html tags
  - This is essentially a mandatory aspect of scraping data from a given page
- At the very least, you should normally try to identify the overall tag that surrounds your data of interest


## Option 1: Data from Tables
- One method in which data is frequently stored on a webpage is in tables
  - These are surrounded by the `< table >`{.html} tag
- So long as the table is fairly simple, R has a very easy way of grabbing the table information directly into a corresponding dataframe
  ```R
  df <- html %>% html_table
  ```
- These will automatically correct for things like cells spanning multiple rows, which is very nice
- By default, this technically returns a list of dataframes for every table on the page


## Option 2: Other Data on a Page
- Sometimes the data you want on from a page isn't clearly going to be the text in a table
  - Maybe it is the url from a link, or an image, or any other text or number not in a table
- In these cases you need to rely on the tag structure of the html document to select purely what you are interested
  - You may also need to access the tag _attributes_ to get information such as link or image urls
- When selecting the tags you want, you can provide multiple separated by spaces to provide a hierarchy of what you are looking for
  - Looking for `'tr td'` says you can all the `td` tags that are inside a `tr` tag
- Gathering the data in this way may generate a list of content, but it won't generally create more complicated tables of information, so you would need to craft those yourself


## Option 2: Selecting the desired tags
- In R, if you are using the `rvest` library, you just need to pass the html into the proper function: `html_elements`
  ```R
  links <- html %>% html_elements('td a')
  ```
  - This will return a list of _all_ the tags matching this hierarchy on the page
- If you only want a single tag, you could just use `html_element()`

## Option 2: Information from tags
- The previous methods will get you a list of the tags that match what you want
- Generally though, you then want some information _from_ those tags, either the enclosed text or some attribute of the tag
- To get the text associated with a tag:
  - `link_text <- only_links %>% html_text()`

- To get an attribute value of a tag (content inside the `<` `>` parts of the tag)

  - `link_url <- only_links %>% html_attr('href')`

## Option 3: APIs
- Sometimes the amount of information in just so large that it can't fit nicely on a webpage, or data providers don't want to make you "scrape" a webpage for the information
- Instead, they might make available a public API where you can access the information
- Most REST APIs look just like a web address, but if you navigate to that url, instead of getting HTML to render a webpage, you get the data directly, most often in a JSON format
  - Many APIs also let you add extra information to the url to better specify _exactly_ what information you want back
  - These generally take the form of parameter strings, and come after a `?` in the url
- Some APIs will require you to register for a key, which is often free. This is to safeguard against people slamming their servers with billions of requests. **Be respectful in both your API and webscraping usage!**

## Option 3: Understanding Endpoints
- Many API's will offer a host of different _endpoints_
- And endpoint is essentially just a specific url that will get you a particular piece of information
- How do you know what endpoints are available?
  - RTFM: You read the @#%!ing manual
  - Any API worth anything will have extensive documentation describing what endpoints are available and what customizations you can apply to each endpoint to get the data you want

## Option 3: Accessing API data
- The information can be downloaded just like html information was downloaded
  - `data <- read_html(url)`
- Commonly, the output will be a string of JSON data, so it helps to use a JSON package to convert it to your language's natural data structures
  - If using the `jsonlite` library, you can just use `fromJSON` to parse the structure into something R can work with
    - `fromJSON` parses _text_, not tags, so be sure to extract the text
  - `output <- data %>% html_text %>% fromJSON`


## Practice Time!
- In your language of choice, see if you can:
  - Extract information about our class schedule [here](http://willamette.edu/~jjrembold/classes/data503/schedule/) into a dataframe that you could then export to CSV
  - Suppose you only wanted to get the text of the days that are red in the table. How could you extract only that text?
  - The API endpoint [here](http://api.open-notify.org/astros.json) will get you information on all the humans currently in space, in JSON format. Create a table of the names of the astronauts and what vessel they are currently on.


-->
<!--------  THEORY ------------------>
</section>
<section id="data-modeling" class="slide level2">
<h2>Data Modeling</h2>
<ul>
<li>Data Modeling is the act of best deciding how to represent and store
data such that it relates to the real world</li>
<li>As much as possible, it is generally desirable to:
<ul>
<li>ensure the model can easily help answer the types of questions you
will want to ask</li>
<li>operate at as low a level of granularity as possible</li>
<li>remove redundancy</li>
<li>ensure referential integrity</li>
</ul></li>
</ul>
</section>
<section id="normalization" class="slide level2">
<h2>Normalization</h2>
<ul>
<li>First introduced by Edgar Codd in the early 1970s</li>
<li>Codd outlined the following goals:
<ul>
<li>to free the collection of relations from undesirable insertion,
update, and deletion dependencies</li>
<li>To reduce the need for restructuring the collection of relations as
new types of data are introduced</li>
<li>To make the relational model more informative to users</li>
<li>To make the collection of relations neutral to what queries are
being run on them</li>
</ul></li>
<li>To assist in these efforts, Codd introduced the idea of <em>normal
forms</em></li>
</ul>
</section>
<section id="what-is-normal" class="slide level2">
<h2>What is normal?</h2>
<ul>
<li>Each normal form builds on those before</li>
<li>The primary normal forms are:</li>
</ul>
<dl>
<dt>Denormalized</dt>
<dd>
No normalization. Nested and redundant data is allowed
</dd>
<dt>First normal form (1NF)</dt>
<dd>
Each column is unique and has a single value. The table has a unique
primary key.
</dd>
<dt>Second normal form (2NF)</dt>
<dd>
Partial dependencies are removed (only necessary if compound primary
key)
</dd>
<dt>Third normal form (3NF)</dt>
<dd>
Each table contains fields only relevant to its primary key, and has no
transitive dependencies
</dd>
</dl>
</section>
<section id="denormalized" class="slide level2">
<h2>Denormalized</h2>
<div class="cols">
<div class="col">
<ul>
<li>APIs will commonly give denormalized data, since they tend to return
JSON type entries</li>
<li>Consider the entry to the right about a particular order</li>
</ul>
</div>
<div class="col" style="flex-grow:2">
<pre ><code class="json" style="max-height:1000px">{ "OrderID": 100,
  "OrderItems": [
    {
      "sku": 1,
      "price": 10,
      "quantity": 1,
      "name": "Thingmajig"
    },
    {
      "sku": 2,
      "price": 25,
      "quantity": 2,
      "name": "Whatchamacalit"
    }],
  "CustomerID": 5,
  "CustomerName": "Jed Rembold",
  "OrderDate": "2022-11-09" }</code></pre>
</div>
</div>
</section>
<section id="initial-attempt" class="slide level2">
<h2>Initial Attempt</h2>
<table style="font-size:.9em">
<tr>
<th>
OrderID
</th>
<th style="width:35%">
OrderItems
</th>
<th>
CustomerID
</th>
<th>
CustomerName
</th>
<th>
OrderDate
</th>
</tr>
<tr>
<td>
100
</td>
<td>
<pre><code class='json' style='font-size:.5em'>
  [
    {
      "sku": 1,
      "price": 10,
      "quantity": 1,
      "name": "Thingmajig"
    },
    {
      "sku": 2,
      "price": 25,
      "quantity": 2,
      "name": "Whatchamacalit"
    }
  ]
    </code></pre>
</td>
<td>
5
</td>
<td>
Jed Rembold
</td>
<td>
2022-11-09
</td>
</tr>
</table>
</section>
<section id="st-normal-form" class="slide level2">
<h2>1st Normal Form</h2>
<div style="font-size: .8em">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 5%" />
<col style="width: 8%" />
<col style="width: 11%" />
<col style="width: 18%" />
<col style="width: 14%" />
<col style="width: 16%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr class="header">
<th>OrderID</th>
<th>Sku</th>
<th>Price</th>
<th>Quantity</th>
<th>ProductName</th>
<th>CustomerID</th>
<th>CustomerName</th>
<th>OrderDate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>100</td>
<td>1</td>
<td>50</td>
<td>1</td>
<td>Thingmajig</td>
<td>5</td>
<td>Jed Rembold</td>
<td>2022-11-09</td>
</tr>
<tr class="even">
<td>100</td>
<td>2</td>
<td>25</td>
<td>2</td>
<td>Whatchamacalit</td>
<td>5</td>
<td>Jed Rembold</td>
<td>2022-11-09</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="st-normal-form-pk" class="slide level2">
<h2>1st Normal Form (PK)</h2>
<div style="font-size: .7em">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 5%" />
<col style="width: 7%" />
<col style="width: 10%" />
<col style="width: 16%" />
<col style="width: 12%" />
<col style="width: 14%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">OrderID</th>
<th style="text-align: center;">ItemNum</th>
<th style="text-align: center;">Sku</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Quantity</th>
<th style="text-align: left;">ProductName</th>
<th style="text-align: center;">CustomerID</th>
<th>CustomerName</th>
<th>OrderDate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">100</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">1</td>
<td style="text-align: left;">Thingmajig</td>
<td style="text-align: center;">5</td>
<td>Jed Rembold</td>
<td>2022-11-09</td>
</tr>
<tr class="even">
<td style="text-align: center;">100</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">25</td>
<td style="text-align: center;">2</td>
<td style="text-align: left;">Whatchamacalit</td>
<td style="text-align: center;">5</td>
<td>Jed Rembold</td>
<td>2022-11-09</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="evaluating-2nf" class="slide level2">
<h2>Evaluating 2NF</h2>
<ul>
<li>To be in second normal form, there can be no partial dependencies,
where columns depend on only one of the compound keys</li>
<li>Here though the last 3 columns all depend only on OrderID
<ul>
<li>Solution: Split to new tables!</li>
</ul></li>
</ul>
</section>
<section id="nd-normal-form" class="slide level2">
<h2>2nd Normal Form</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">OrderID</th>
<th style="text-align: center;">CustomerID</th>
<th>CustomerName</th>
<th>OrderDate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">100</td>
<td style="text-align: center;">5</td>
<td>Jed Rembold</td>
<td>2022-11-09</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">OrderID</th>
<th style="text-align: center;">ItemNum</th>
<th style="text-align: center;">Sku</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Quantity</th>
<th>ProductName</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">100</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">1</td>
<td>Thingmajig</td>
</tr>
<tr class="even">
<td style="text-align: center;">100</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">25</td>
<td style="text-align: center;">2</td>
<td>Whatchamacalit</td>
</tr>
</tbody>
</table>
</section>
<section id="evaluating-3nf" class="slide level2">
<h2>Evaluating 3NF</h2>
<ul>
<li>The third normal form prohibits transitive dependencies, where a
column depends on another (that depends on the primary key), instead of
depending directly on the primary key</li>
<li>Here we have 2! One in each table:
<ul>
<li><code class="python">ProductName</code> depends on
<code class="python">Sku</code></li>
<li><code class="python">CustomerName</code> depends on
<code class="python">CustomerID</code></li>
</ul></li>
<li>Solution? More tables!</li>
</ul>
</section>
<section id="rd-normal-form" class="slide level2">
<h2>3rd Normal Form</h2>
<div style="font-size:.9em">
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Sku</th>
<th>ProductName</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td>Thingmajig</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td>Whatchamacalit</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">CustomerID</th>
<th>CustomerName</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">5</td>
<td>Jed Rembold</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">OrderID</th>
<th style="text-align: center;">ItemNum</th>
<th style="text-align: center;">Sku</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Quantity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">100</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">100</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">25</td>
<td style="text-align: center;">2</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">OrderID</th>
<th style="text-align: center;">CustomerID</th>
<th>OrderDate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">100</td>
<td style="text-align: center;">5</td>
<td>2022-11-09</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="visually" class="slide level2">
<h2>Visually</h2>
<p><img data-src="../images/normal_forms_example.png"
style="width:100.0%" /></p>
</section>
<section id="beyond" class="slide level2">
<h2>Beyond</h2>
<ul>
<li>Other normal forms exist (up to 6NF in the Boyce-Codd system)</li>
<li>Most people only care about the first 3 to get data in a
“normalized” state</li>
<li>Unless you have specific performance reasons for wanting otherwise,
you really should strive for normalized tables in your relational
database, as they make maintaining, adding, updating, and adjusting your
database and tables much easier</li>
</ul>
</section>
<section id="break-time" class="slide level2">
<h2>Break Time!</h2>
<p><img data-src="../images/nomming_catepillar.png" /></p>
<!---------------- SQL ------------------>
</section>
<section id="overview" class="slide level2">
<h2>Overview</h2>
<ul>
<li>Chapter 9 is essentially a tale in two parts, which are closely
entwined
<ul>
<li>Data is likely going to be messy. How do you go about cleaning up
data for further analysis. What sorts of anomalies should you keep an
eye out for?</li>
<li>Tables are usually not static entities, but stores of data that
might be changing. How you can make adjustments not only to the contents
of a table but to the design of the table itself?</li>
</ul></li>
<li>We could look at either piece first, but let’s look first at
cleaning data to provide the motivation for altering our tables
<ul>
<li>Many of the issues we’ll look at could have been avoided with good
use of constraints. But for now we are supposing that the data was
generated outside the table, and you have just imported it in
naively.</li>
</ul></li>
</ul>
</section>
<section id="cleaning-checking-for-duplicates" class="slide level2">
<h2>Cleaning: Checking for Duplicates</h2>
<ul>
<li>We’ve already seen in homework sample sets that there are sometimes
duplicate row entries</li>
<li>Duplicate entries across <em>many</em> columns is usually the sign
<!--- A duplicate entry in just one or two columns is frequently not cause for concern (unless you were expecting that column to have unique values)--></li>
<li><code class="python">GROUP BY</code> and
<code class="python">HAVING</code> can be very useful here!
<ul>
<li><code class="python">GROUP BY</code> all the columns that you want
to check for repetition</li>
<li>Use <code class="python">HAVING</code> to only grab those groups
that have more than one element (and thus a repetition)</li>
</ul>
<pre ><code class="pgsql">SELECT col1, col2, col3, col4, COUNT(*)
FROM table_name
GROUP BY col1, col2, col3, col4
HAVING COUNT(*) > 1;</code></pre></li>
</ul>
</section>
<section id="cleaning-checking-for-missing" class="slide level2">
<h2>Cleaning: Checking for Missing</h2>
<ul>
<li>Data sets can sometimes (often even) be missing data that really
should be present</li>
<li>Fixing this generally requires some knowledge of what the data is
representing</li>
<li>Finding missing values can still tell you important things about the
quality of your data though</li>
<li>A nice way to count the number of nulls in different columns
is:</li>
</ul>
<pre ><code class="pgsql">SELECT
  COUNT(*) - COUNT(col1) as col1,
  COUNT(*) - COUNT(col2) as col2
FROM table_name;</code></pre>
</section>
<section id="cleaning-inconsistent-data" class="slide level2">
<h2>Cleaning: Inconsistent Data</h2>
<ul>
<li>Especially for textual fields, there can be variation in how data is
entered
<ul>
<li>Typos happen, or people just refer to the same thing in different
ways</li>
</ul></li>
<li>To use <code class="python">GROUP BY</code> effectively, you really
need categories to be consistently named across the data set</li>
<li>Several possible approaches to identify:
<ul>
<li>Scanning over a sorted distinct column for quasi-duplications:
phrases that are just a bit distinct
<ul>
<li><code class="python">GROUP BY</code> could do similar but add
counts</li>
</ul></li>
<li>Use pattern matching to look for duplicates matching a single
approximate pattern</li>
<li>Use the fuzzystrmatch module to check Levershtein distances
(probably rather slow)</li>
</ul></li>
</ul>
</section>
<section id="cleaning-checking-text-length" class="slide level2">
<h2>Cleaning: Checking Text Length</h2>
<ul>
<li>For certain fields, you’d expect text of a certain number of
characters
<ul>
<li>2 for state abbreviations</li>
<li>5 for zip codes</li>
<li>13 for isbn13</li>
</ul></li>
<li>Can be a good idea to check these using the
<code class="python">LENGTH</code> string function
<ul>
<li><code class="python">LENGTH(str)</code> just returns the number of
characters in said string</li>
</ul>
<pre ><code class="pgsql">SELECT *
FROM table_name
WHERE LENGTH(col1) != 5;</code></pre></li>
</ul>
</section>
<section id="damage-control" class="slide level2">
<h2>Damage Control</h2>
<ul>
<li>It can be a lot of work to clean up a table</li>
<li>Evaluate whether it is worth it!
<ul>
<li>Maybe a better, cleaner data set exists?</li>
</ul></li>
<li>Sometimes, data will be missing that you simply can’t fill in
<ul>
<li>Can your analysis work around those columns?</li>
</ul></li>
</ul>
</section>
<section id="making-adjustments" class="slide level2">
<h2>Making Adjustments</h2>
<div class="cols">
<div class="col">
<ul>
<li>Changing existing tables can generally be broken down into two
categories:
<ul>
<li>Changing the structure of the table itself
<ul>
<li>Uses keywords <code class="python">ALTER TABLE</code></li>
</ul></li>
<li>Changing the row content within the table
<ul>
<li>Uses keyword <code class="python">UPDATE</code></li>
</ul></li>
</ul></li>
</ul>
</div>
<div class="col">
<p><img data-src="../images/altering_table.jpg"
style="width:100.0%" /></p>
</div>
</div>
</section>
<section id="table-altering-part-1" class="slide level2">
<h2>Table Altering: Part 1</h2>
<ul>
<li><p><code class="python">ALTER TABLE</code> is generally followed by
the table name and then another keyword command, depending on what you
want to do</p>
<pre ><code class="pgsql">ALTER TABLE table_name ...</code></pre>
<ul>
<li><p>Adding columns:</p>
<pre ><code class="pgsql">... ADD COLUMN col_name data_type;</code></pre></li>
<li><p>Removing columns</p>
<pre ><code class="pgsql">... DROP COLUMN col_name;</code></pre></li>
</ul></li>
</ul>
</section>
<section id="table-altering-part-2" class="slide level2">
<h2>Table Altering: Part 2</h2>
<pre ><code class="pgsql">ALTER TABLE table_name ...</code></pre>
<ul>
<li><p>Changing columns</p>
<pre ><code class="pgsql" style="font-size:.9em">... ALTER COLUMN col_name SET DATA TYPE data_type;
... ALTER COLUMN col_name SET NOT NULL;</code></pre></li>
<li><p>Renaming columns</p>
<pre ><code class="pgsql" style="font-size:.9em">... RENAME col_name TO new_col_name;</code></pre></li>
<li><p>Rename entire table</p>
<pre ><code class="pgsql" style="font-size:.9em">... RENAME TO new_table_name;</code></pre></li>
</ul>
</section>
<section id="updating-tables" class="slide level2">
<h2>Updating Tables</h2>
<ul>
<li>If you want to change the values in a particular row (or many rows),
you don’t want to alter the table, you want to
<code class="python">UPDATE</code> it</li>
<li><code class="python">UPDATE</code> sets particular columns to a
particular value
<ul>
<li><strong>BE CAREFUL!</strong> If you do not specify <em>which</em>
rows, then <strong>ALL</strong> of the rows will have that column
changed to that value
<ul>
<li>This is partly why having primary keys is so nice: it gives you a
method to update just a single row should you need</li>
</ul>
<pre ><code class="pgsql">UPDATE table_name
SET col_name = new_value;</code></pre></li>
</ul></li>
<li>You can specify which rows should be changed by filtering with
<code class="python">WHERE</code></li>
</ul>
</section>
<section id="understanding-check" class="slide level2">
<h2>Understanding Check</h2>
<div class="cols">
<div class="col">
<p>The table named <code class="python">revq</code> to the right is
acted upon by the below SQL queries. What entries in the table are left
untouched once all queries have been run? Each choice corresponds to
those highlighted cells.</p>
</div>
<div class="col">
<p><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- Created with Inkscape (http://www.inkscape.org/) -->

<svg
   width="153.30701mm"
   height="102.056mm"
   viewBox="0 0 153.30701 102.056"
   version="1.1"
   id="svg5"
   xml:space="preserve"
   inkscape:version="1.2.1 (9c6d41e410, 2022-07-14, custom)"
   sodipodi:docname="uc_ch9_2.svg"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:svg="http://www.w3.org/2000/svg"><sodipodi:namedview
     id="namedview7"
     pagecolor="#ffffff"
     bordercolor="#000000"
     borderopacity="0.25"
     inkscape:showpageshadow="2"
     inkscape:pageopacity="0.0"
     inkscape:pagecheckerboard="0"
     inkscape:deskcolor="#d1d1d1"
     inkscape:document-units="mm"
     showgrid="false"
     inkscape:zoom="0.84096521"
     inkscape:cx="306.79034"
     inkscape:cy="202.14867"
     inkscape:window-width="1680"
     inkscape:window-height="1020"
     inkscape:window-x="0"
     inkscape:window-y="30"
     inkscape:window-maximized="1"
     inkscape:current-layer="layer1" /><defs
     id="defs2" /><g
     inkscape:label="Layer 1"
     inkscape:groupmode="layer"
     id="layer1"
     transform="translate(-94.538953,-23.838356)"><path
       style="fill:#000000;stroke:#000000;stroke-width:0.9816;stroke-linecap:round;stroke-dasharray:none"
       d="M 97.029611,26.329082 H 211.65658"
       id="path296" /><path
       style="fill:#000000;stroke:#000000;stroke-width:0.9816;stroke-linecap:round;stroke-dasharray:none"
       d="M 97.029611,122.165 H 211.65658"
       id="path975" /><path
       style="fill:#000000;stroke:#000000;stroke-width:0.434336;stroke-linecap:round;stroke-dasharray:none"
       d="M 97.029611,62.699642 H 211.65658"
       id="path977" /><text
       xml:space="preserve"
       style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:12.5679px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Bold';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#000000;stroke:none;stroke-width:0.989595;stroke-linecap:round;stroke-dasharray:none"
       x="101.53363"
       y="41.13623"
       id="text1033"><tspan
         sodipodi:role="line"
         id="tspan1031"
         style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:12.5679px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Bold';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;stroke:none;stroke-width:0.989595"
         x="101.53363"
         y="41.13623">col1</tspan></text><text
       xml:space="preserve"
       style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:12.5679px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Bold';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#000000;stroke:none;stroke-width:0.989595;stroke-linecap:round;stroke-dasharray:none"
       x="141.62927"
       y="41.13623"
       id="text1037"><tspan
         sodipodi:role="line"
         id="tspan1035"
         style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:12.5679px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Bold';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;stroke:none;stroke-width:0.989595"
         x="141.62927"
         y="41.13623">col2</tspan></text><text
       xml:space="preserve"
       style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:12.5679px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Bold';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#000000;stroke:none;stroke-width:0.989595;stroke-linecap:round;stroke-dasharray:none"
       x="182.6946"
       y="41.13623"
       id="text1041"><tspan
         sodipodi:role="line"
         id="tspan1039"
         style="font-style:normal;font-variant:normal;font-weight:bold;font-stretch:normal;font-size:12.5679px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Bold';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;stroke:none;stroke-width:0.989595"
         x="182.6946"
         y="41.13623">col3</tspan></text><text
       xml:space="preserve"
       style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12.1532px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#6281ac;fill-opacity:1;stroke:none;stroke-width:0.956942;stroke-linecap:round;stroke-dasharray:none"
       x="100.15795"
       y="56.296406"
       id="text1095"><tspan
         sodipodi:role="line"
         id="tspan1093"
         style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12.1532px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#6281ac;fill-opacity:1;stroke-width:0.956942"
         x="100.15795"
         y="56.296406">TEXT</tspan></text><text
       xml:space="preserve"
       style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12.1532px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#6281ac;fill-opacity:1;stroke:none;stroke-width:0.956942;stroke-linecap:round;stroke-dasharray:none"
       x="141.11984"
       y="56.296406"
       id="text1822"><tspan
         sodipodi:role="line"
         id="tspan1820"
         style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12.1532px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#6281ac;fill-opacity:1;stroke-width:0.956942"
         x="141.11984"
         y="56.296406">REAL</tspan></text><text
       xml:space="preserve"
       style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12.1532px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#6281ac;fill-opacity:1;stroke:none;stroke-width:0.956942;stroke-linecap:round;stroke-dasharray:none"
       x="185.97403"
       y="56.296406"
       id="text1826"><tspan
         sodipodi:role="line"
         id="tspan1824"
         style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:12.1532px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#6281ac;fill-opacity:1;stroke-width:0.956942"
         x="185.97403"
         y="56.296406">INT</tspan></text><text
       xml:space="preserve"
       style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:13.7716px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.492176;stroke-linecap:round;stroke-dasharray:none"
       x="108.8076"
       y="77.305122"
       id="text1932"><tspan
         sodipodi:role="line"
         id="tspan1930"
         style="fill:#000000;stroke-width:0.492176"
         x="108.8076"
         y="77.305122">A</tspan></text><text
       xml:space="preserve"
       style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:13.7716px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;text-align:center;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.492176;stroke-linecap:round;stroke-dasharray:none"
       x="154.84677"
       y="77.305122"
       id="text1956"><tspan
         sodipodi:role="line"
         id="tspan1954"
         style="text-align:center;text-anchor:middle;fill:#000000;stroke-width:0.492176"
         x="154.84677"
         y="77.305122">0.24</tspan></text><text
       xml:space="preserve"
       style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:13.7716px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;text-align:center;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.492176;stroke-linecap:round;stroke-dasharray:none"
       x="195.58284"
       y="77.305122"
       id="text1968"><tspan
         sodipodi:role="line"
         id="tspan1966"
         style="text-align:center;text-anchor:middle;fill:#000000;stroke-width:0.492176"
         x="195.58284"
         y="77.305122">15</tspan></text><text
       xml:space="preserve"
       style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:13.7716px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.492176;stroke-linecap:round;stroke-dasharray:none"
       x="108.42769"
       y="96.991028"
       id="text1936"><tspan
         sodipodi:role="line"
         id="tspan1934"
         style="fill:#000000;stroke-width:0.492176"
         x="108.42769"
         y="96.991028">B</tspan></text><text
       xml:space="preserve"
       style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:13.7716px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;text-align:center;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.492176;stroke-linecap:round;stroke-dasharray:none"
       x="156.08406"
       y="96.991028"
       id="text1960"><tspan
         sodipodi:role="line"
         id="tspan1958"
         style="text-align:center;text-anchor:middle;fill:#000000;stroke-width:0.492176"
         x="156.08406"
         y="96.991028">9.1</tspan></text><text
       xml:space="preserve"
       style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:13.7716px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;text-align:center;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.492176;stroke-linecap:round;stroke-dasharray:none"
       x="195.85854"
       y="96.991028"
       id="text1972"><tspan
         sodipodi:role="line"
         id="tspan1970"
         style="text-align:center;text-anchor:middle;fill:#000000;stroke-width:0.492176"
         x="195.85854"
         y="96.991028">4</tspan></text><text
       xml:space="preserve"
       style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:13.7716px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.492176;stroke-linecap:round;stroke-dasharray:none"
       x="108.61933"
       y="116.69038"
       id="text1940"><tspan
         sodipodi:role="line"
         id="tspan1938"
         style="fill:#000000;stroke-width:0.492176"
         x="108.61933"
         y="116.69038">C</tspan></text><text
       xml:space="preserve"
       style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:13.7716px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;text-align:center;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.492176;stroke-linecap:round;stroke-dasharray:none"
       x="155.09892"
       y="116.69038"
       id="text1964"><tspan
         sodipodi:role="line"
         id="tspan1962"
         style="text-align:center;text-anchor:middle;fill:#000000;stroke-width:0.492176"
         x="155.09892"
         y="116.69038">4</tspan></text><text
       xml:space="preserve"
       style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:13.7716px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;text-align:center;text-anchor:middle;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.492176;stroke-linecap:round;stroke-dasharray:none"
       x="195.52232"
       y="116.69038"
       id="text1976"><tspan
         sodipodi:role="line"
         id="tspan1974"
         style="text-align:center;text-anchor:middle;fill:#000000;stroke-width:0.492176"
         x="195.52232"
         y="116.69038">10</tspan></text><rect
       style="fill:#ff0000;fill-opacity:0.297502;stroke:none;stroke-width:0.403014;stroke-linecap:round;stroke-dasharray:none"
       id="rect2072"
       width="74.09626"
       height="17.42337"
       x="134.86285"
       y="63.780529"
       ry="5.1545014" /><rect
       style="fill:#00e2ff;fill-opacity:0.297502;stroke:none;stroke-width:0.390717;stroke-linecap:round;stroke-dasharray:none"
       id="rect3478"
       width="21.745987"
       height="55.799976"
       x="185.08685"
       y="63.54591"
       ry="6.433053" /><rect
       style="fill:#00d779;fill-opacity:0.297502;stroke:none;stroke-width:0.391625;stroke-linecap:round;stroke-dasharray:none"
       id="rect3480"
       width="70.689957"
       height="17.245436"
       x="84.162178"
       y="162.00232"
       ry="5.1018615"
       transform="matrix(0.89292302,-0.45020938,0.40934778,0.91237843,0,0)" /><rect
       style="fill:#d700cc;fill-opacity:0.297502;stroke:none;stroke-width:0.434336;stroke-linecap:round;stroke-dasharray:none"
       id="rect3534"
       width="36.34494"
       height="37.63588"
       x="138.1024"
       y="64.224426"
       ry="6.2449827" /><text
       xml:space="preserve"
       style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:24.2824px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;text-align:center;text-anchor:middle;fill:#d700cc;fill-opacity:0.8;stroke:none;stroke-width:0.867818;stroke-linecap:round;stroke-dasharray:none"
       x="238.46535"
       y="48.250973"
       id="text4890"><tspan
         sodipodi:role="line"
         id="tspan4888"
         style="fill:#d700cc;fill-opacity:0.8;stroke-width:0.867818"
         x="238.46535"
         y="48.250973">A</tspan></text><text
       xml:space="preserve"
       style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:24.2824px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;text-align:center;text-anchor:middle;fill:#ff0000;fill-opacity:0.8;stroke:none;stroke-width:0.867818;stroke-linecap:round;stroke-dasharray:none"
       x="238.46535"
       y="71.033676"
       id="text4894"><tspan
         sodipodi:role="line"
         id="tspan4892"
         style="fill:#ff0000;fill-opacity:0.8;stroke-width:0.867818"
         x="238.46535"
         y="71.033676">B</tspan></text><text
       xml:space="preserve"
       style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:24.2824px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;text-align:center;text-anchor:middle;fill:#00d779;fill-opacity:0.8;stroke:none;stroke-width:0.867818;stroke-linecap:round;stroke-dasharray:none"
       x="238.46535"
       y="94.065376"
       id="text5243"><tspan
         sodipodi:role="line"
         id="tspan5241"
         style="fill:#00d779;fill-opacity:0.8;stroke-width:0.867818"
         x="238.46535"
         y="94.065376">C</tspan></text><text
       xml:space="preserve"
       style="font-style:italic;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:24.2824px;font-family:sans-serif;-inkscape-font-specification:'sans-serif, Italic';font-variant-ligatures:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-east-asian:normal;text-align:center;text-anchor:middle;fill:#00e1ff;fill-opacity:0.8;stroke:none;stroke-width:0.867818;stroke-linecap:round;stroke-dasharray:none"
       x="238.46535"
       y="117.08521"
       id="text5247"><tspan
         sodipodi:role="line"
         id="tspan5245"
         style="fill:#00e1ff;fill-opacity:0.8;stroke-width:0.867818"
         x="238.46535"
         y="117.08521">D</tspan></text></g></svg>
</p>
</div>
</div>
<pre ><code class="pgsql" style="font-size:.85em;">ALTER TABLE revq ADD COLUMN col4 INT;
UPDATE revq SET col4 = col2;
UPDATE revq SET (col2,col3)=(col3, col2) WHERE col1 IN ('B','C');
UPDATE revq SET col3 = col3 - col4;
UPDATE revq SET col2 = col2 + col4 WHERE col3 > 10;
ALTER TABLE revq DROP COLUMN col4;</code></pre>
</section>
<section id="backup-tables" class="slide level2">
<h2>Backup Tables</h2>
<ul>
<li><p>Frequently, if you are about to heavily modify a table, you
should consider working on a backup copy</p></li>
<li><p>We actually have already seen the basic machinery for this:</p>
<pre ><code class="pgsql" style="font-size:0.9em">CREATE TABLE new_table AS
SELECT * FROM og_table;</code></pre></li>
<li><p><strong>Note:</strong> Indexes and constraints are stored
separately, and so are NOT copied over using this process!</p></li>
<li><p>For including constraints and indexes, you can use a Postgres
specific syntax, it the newly created table will initially be missing
the data</p>
<pre ><code class="pgsql" style="font-size:0.9em">CREATE TABLE new_table
(LIKE og_table INCLUDING ALL);</code></pre></li>
</ul>
</section>
<section id="table-to-table" class="slide level2">
<h2>Table to Table</h2>
<ul>
<li><p>In some cases, you’ll want to update or pass information across
tables</p>
<ul>
<li>Maybe one table has newer values that you want to use to update the
original table</li>
</ul></li>
<li><p>In core SQL, you’d need to use subqueries, which we’ll be talking
about in a few chapters</p></li>
<li><p>In Postgres, to update, you can use
<code class="python">FROM</code>:</p>
<pre ><code class="pgsql" style="font-size:.9em">UPDATE table_name1
SET col_name = table_name2.col_name
FROM table_name2
WHERE table_name.col1 = table_name2.col1;</code></pre></li>
<li><p>To insert values from another table into another:</p>
<pre ><code class="pgsql" style="font-size:.9em">INSERT INTO new_table SELECT * FROM old_table;</code></pre></li>
</ul>
</section>
<section id="deletions" class="slide level2">
<h2>Deletions</h2>
<ul>
<li>Similar to changing tables, removing things from tables has two main
keywords:
<ul>
<li><code class="python">DROP</code> for removing aspects of a table
like columns, constraints, indexes, or the table itself</li>
<li><code class="python">DELETE FROM</code> for removing rows from
tables</li>
</ul></li>
<li><code class="python">DROP</code> will frequently come after an
<code class="python">ALTER TABLE</code> unless you are dropping the
table itself</li>
<li><code class="python">DELETE FROM</code> without a filter will
<strong>delete all rows</strong>
<ul>
<li>Make absolutely sure you are using a filter if you don’t want that
to happen!</li>
<li>Another good reason to make up your tables before editing them</li>
</ul></li>
</ul>
</section>
<section id="getting-deleted" class="slide level2">
<h2>Getting Deleted</h2>
<pre ><code class="pgsql">ALTER TABLE tname DROP COLUMN colname;
ALTER TABLE tname DROP CONSTRAINT const_name;
DROP INDEX index_name;
DROP TABLE tname;

DELETE FROM tname; -- All rows gone!
DELETE FROM tname WHERE condition;</code></pre>
<ul>
<li>In general, unless you have an important reason, don’t remove actual
data from a table
<ul>
<li>You can filter it, you can create new tables that are missing that
data, etc.</li>
</ul></li>
</ul>
</section>
<section id="transactions" class="slide level2">
<h2>Transactions</h2>
<ul>
<li><em>Atomicity</em> is an important aspect of most database changes
<ul>
<li>The idea that related changes should happen in a single,
self-contained step</li>
</ul></li>
<li>Many changes you might make to a database have several steps though!
<ul>
<li>Need to change one value in one table and another value in another
table</li>
<li>Need to create a new row and then copy some information into it</li>
</ul></li>
<li>Remember that, in general, others can access the database at the
same time
<ul>
<li>What if they tried to access the data you were working on
mid-operation?</li>
</ul></li>
<li>To solve these issues, SQL has the concept of a
<em>transaction</em></li>
</ul>
</section>
<section id="bundling-up" class="slide level2">
<h2>Bundling Up</h2>
<ul>
<li>A <em>transaction</em> is essentially a bundling of several
statements into one, discrete change to the database</li>
<li>Commands within the transaction have not yet modified the database,
but exist only in local memory</li>
<li>Changes get written to the database all at once upon the conclusion
of the transaction</li>
<li>Starting a transaction?
<ul>
<li><code class="python">START TRANSACTION;</code> or
<code class="python">BEGIN;</code></li>
</ul></li>
<li>Ending a transaction?
<ul>
<li><code class="python">COMMIT;</code> actually makes the changes</li>
<li><code class="python">ROLLBACK;</code> throws out everything within
the transaction</li>
</ul></li>
</ul>
</section>
<section id="uses-of-transactions" class="slide level2">
<h2>Uses of Transactions</h2>
<ul>
<li>Protecting against system faults
<ul>
<li>What if you have a system crash in the middle of an operation?
<ul>
<li>What commands had been run? What commands had not?</li>
</ul></li>
<li>Transactions actually write to a log what they are <em>going</em> to
do before they actually do it. So in case of a crash, then the
transaction can then simply be rerun</li>
</ul></li>
<li>Protecting against simultaneous access
<ul>
<li>Changes occur all at once, so it is impossible for another database
user to access data “mid-change”</li>
<li>Other users of the database will see none of your changes until
actually committed</li>
</ul></li>
<li>Testing changes
<ul>
<li>Sometimes it is useful to check to see that some changes look the
way you wanted before actually changing the database</li>
<li>Embedding within a transaction block always gives you the option to
rollback</li>
</ul></li>
</ul>
</section>
<section id="practice-activity" class="slide level2">
<h2>Practice Activity</h2>
<ul>
<li>There is a simple CSV of presidents and debt <a
href="../activity_data/presidents.csv">here</a></li>
<li>It has some problems regarding missing, duplicated, or inconsistent
data which you should determine and fix <em>before</em> answering the
following questions:
<ul>
<li>What are the top 5 presidents to have the greatest average annual
increase in national debt over the years of their presidency?</li>
<li>How do the median values of annual increases in national debt
compare across party lines?</li>
<li>Trickier: What is the average <em>change</em> in the annual increase
percentage of national debt each year over all the years?</li>
</ul></li>
</ul>
</section>
<section id="groups" class="slide level2">
<h2>Groups</h2>
<ul>
<li>You’ll be working in pairs, one computer used per group
<ul>
<li>Rotate who is typing periodically!</li>
</ul></li>
<li>Pairs:
<ul>
<li>Group A: Oscar, Phil, and Frances</li>
<li>Group B: Alaina and Cristian</li>
<li>Group C: Jill and Miles</li>
<li>Group D: Aaryan And Micah</li>
</ul></li>
</ul>
</section>
<section id="question-answers" class="slide level2">
<h2>Question Answers</h2>
<ul>
<li>What are the top 5 presidents to have the greatest average annual
increase in national debt over the years of their presidency?
<ul>
<li>Reagan, HW Bush, Ford, Carter, Obama</li>
</ul></li>
<li>How do the median values of annual increases in national debt
compare across party lines?
<ul>
<li>Democrats: 3.65%</li>
<li>Republicans: 7.40%</li>
</ul></li>
<li>Trickier: What is the average <em>change</em> in the annual increase
percentage of national debt overall all the years?
<ul>
<li>Only about 0.05%, but seemingly a slight steady increase</li>
</ul></li>
</ul>
</section>
    </div>
  </div>

  <script src="../html_srcs/revealjs/dist/reveal.js"></script>

  // reveal.js plugins
  <script src="../html_srcs/revealjs/plugin/notes/notes.js"></script>
  <script src="../html_srcs/revealjs/plugin/search/search.js"></script>
  <script src="../html_srcs/revealjs/plugin/zoom/zoom.js"></script>
  // Added plugins
  <script src="../html_srcs/revealjs/../plugin/chart/Chart.min.js"></script>
  <script src="../html_srcs/revealjs/../plugin/chart/plugin.js"></script>
  <script src="../html_srcs/revealjs/../plugin/chalkboard/plugin.js"></script>
  <script src="../html_srcs/revealjs/../plugin/menu/menu.js"></script>
  <script src="../html_srcs/revealjs/../other_plugins/reveal.js-d3/reveald3.js"></script>
  <script src="../html_srcs/revealjs/plugin/math/math.js"></script>
  <script src="../html_srcs/revealjs/plugin/highlight/highlight.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
		//autoAnimateEasing: 'ease-in',
		//autoAnimateDuration: 1.0,
		//autoAnimateUnmatched: false,
        pdfSeparateFragments: false,
        // Display controls in the bottom right corner
        controls: true,
        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,
        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',
        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',
        // Display a presentation progress bar
        progress: true,
        // Display the page number of the current slide
        slideNumber: true,
        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,
        // Push each slide change to the browser history
        history: true,
        // Enable keyboard shortcuts for navigation
        keyboard: true,
        // Enable the slide overview mode
        overview: true,
        // Vertical centering of slides
        center: false,
        // Enables touch navigation on devices with touch input
        touch: true,
        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',
        // Turns fragments on and off globally
        fragments: true,
        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: true,
        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,
        // Global override for autoplaying embedded media (video/audio/iframe)
        // - null: Media will only autoplay if data-autoplay is present
        // - true: All media will autoplay, regardless of individual setting
        // - false: No media will autoplay, regardless of individual setting
        autoPlayMedia: null,
        // Global override for preloading lazy-loaded iframes
        // - null: Iframes with data-src AND data-preload will be loaded when within
        //   the viewDistance, iframes with only data-src will be loaded when visible
        // - true: All iframes with data-src will be loaded when within the viewDistance
        // - false: All iframes with data-src will be loaded only when visible
        preloadIframes: null,
        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,
        // Stop auto-sliding after user input
        autoSlideStoppable: true,
        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,
        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,
        // Hide cursor if inactive
        hideInactiveCursor: true,
        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,
        // Transition style
        transition: 'fade', // none/fade/slide/convex/concave/zoom
        // Transition speed
        transitionSpeed: 'default', // default/fast/slow
        // Transition style for full page slide backgrounds
        backgroundTransition: 'fade', // none/fade/slide/convex/concave/zoom
        // Number of slides away from the current that are visible
        viewDistance: 3,
        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,
        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1920,
        height: 1200,
        // The display mode that will be used to show slides
        display: 'block',
		math: {
		  <!--mathjax: '../html_srcs/reveal.js/plugin/math/mathjax/tex-mml-chtml.js',-->
		  <!--config: 'tex-mml-chtml',-->
		  <!--tex2jax: {-->
			<!--inlineMath: [['\\(','\\)']],-->
			<!--displayMath: [['\\[','\\]']],-->
			<!--balanceBraces: true,-->
			<!--processEscapes: false,-->
			<!--processRefs: true,-->
			<!--processEnvironments: true,-->
			<!--preview: 'TeX',-->
			<!--skipTags: ['script','noscript','style','textarea','pre','code'],-->
			<!--ignoreClass: 'tex2jax_ignore',-->
			<!--processClass: 'tex2jax_process'-->
		  <!--},-->
		  CommonHTML: {scale: 80},
		},
	reveald3: {
			runLastState: true, // true/false, default: true
			onSlideChangedDelay: 200,
			mapPath: false, // true / false / "spefific/path/as/string", default: false
			tryFallbackURL: true, // true/false, default false
			disableCheckFile: false, //default false
		 },

        // reveal.js plugins
        plugins: [
		  RevealMath,
          RevealHighlight,
          RevealNotes,
          RevealSearch,
          RevealZoom,
		  RevealChart,
		  RevealChalkboard,
          RevealMenu,
          Reveald3,
        ],
		chalkboard: {
          boardmarkerWidth: 4,
          chalkWidth: 7,
          boardmarkers : [
                  { color: 'rgba(46,52,64,1)',    cursor: 'url(' + path + 'img/boardmarker-black.png), auto'},
                  { color: 'rgba(94,129,172,1)',  cursor: 'url(' + path + 'img/boardmarker-blue.png), auto'},
                  { color: 'rgba(191,97,106,1)',  cursor: 'url(' + path + 'img/boardmarker-red.png), auto'},
                  { color: 'rgba(163,190,140,1)', cursor: 'url(' + path + 'img/boardmarker-green.png), auto'},
                  { color: 'rgba(208,135,112,1)', cursor: 'url(' + path + 'img/boardmarker-orange.png), auto'},
                  { color: 'rgba(180,142,173,1)', cursor: 'url(' + path + 'img/boardmarker-purple.png), auto'},
                  { color: 'rgba(235,203,139,1)', cursor: 'url(' + path + 'img/boardmarker-yellow.png), auto'}
          ],
          chalks: [
                  { color: 'rgba(216,222,223,0.5)',cursor: 'url(' + path + 'img/chalk-white.png), auto'},
                  { color: 'rgba(94,129,172,0.5)', cursor: 'url(' + path + 'img/chalk-blue.png), auto'},
                  { color: 'rgba(191,97,106,0.5)', cursor: 'url(' + path + 'img/chalk-red.png), auto'},
                  { color: 'rgba(163,190,140,0.5)',cursor: 'url(' + path + 'img/chalk-green.png), auto'},
                  { color: 'rgba(208,135,112,0.5)',cursor: 'url(' + path + 'img/chalk-orange.png), auto'},
                  { color: 'rgba(180,142,173,0.5)',cursor: 'url(' + path + 'img/chalk-purple.png), auto'},
                  { color: 'rgba(235,203,139,0.5)',cursor: 'url(' + path + 'img/chalk-yellow.png), auto'}
          ]
		},
		dependencies: [
            // { src: "../html_srcs/revealjs/plugin/title-footer/title-footer.js", async: true, callback: function() { title_footer.initialize({css:"../html_srcs/revealjs/plugin/title-footer/title-footer.css"}); } },
            //{ src: "../html_srcs/revealjs/plugin/d3/reveald3.js" },
		],
      });
    </script>
    </body>
</html>
