<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Jed Rembold">
  <meta name="dcterms.date" content="2025-02-19">
  <title>Grouping JSON Model Indexes</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../html_srcs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../html_srcs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
  </style>
  <link rel="stylesheet" href="../html_srcs/revealjs/../css/theme/nord_light.css" id="theme">
  <link rel="stylesheet" href="../html_srcs/revealjs/../css/highlight/nord.css">
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Grouping JSON Model Indexes</h1>
  <p class="author">Jed Rembold</p>
  <p class="date">February 19, 2025</p>
</section>

<section id="announcements" class="slide level2">
<h2>Announcements</h2>
<ul>
<li>Homework 5 due tonight!</li>
<li>Homework 6 due next Wednesday</li>
<li><strong>No class next week!</strong>
<ul>
<li>I’ll be in Pittsburgh for SIGCSE</li>
<li>Instead, next Wednesday you’ll be sent the description and
requirements of the midterm tutorial video assignment</li>
<li>You’ll have until the following Wednesday (March 5th) to submit a
link to that upload</li>
</ul></li>
</ul>
<!--------  THEORY ------------------>
</section>
<section>
<section id="building-a-model" class="title-slide slide level1">
<h1>Building a Model</h1>

</section>
<section id="data-modeling" class="slide level2">
<h2>Data Modeling</h2>
<ul>
<li>Data Modeling is the act of best deciding how to represent and store
data such that it relates to the real world</li>
<li>As much as possible, it is generally desirable to:
<ul>
<li>ensure the model can easily help answer the types of questions you
will want to ask</li>
<li>operate at as low a level of granularity as possible</li>
<li>remove redundancy</li>
<li>ensure referential integrity</li>
</ul></li>
</ul>
</section>
<section id="normalization" class="slide level2">
<h2>Normalization</h2>
<ul>
<li>First introduced by Edgar Codd in the early 1970s</li>
<li>Codd outlined the following goals:
<ul>
<li>to free the collection of relations from undesirable insertion,
update, and deletion dependencies</li>
<li>To reduce the need for restructuring the collection of relations as
new types of data are introduced</li>
<li>To make the relational model more informative to users</li>
<li>To make the collection of relations neutral to what queries are
being run on them</li>
</ul></li>
<li>To assist in these efforts, Codd introduced the idea of <em>normal
forms</em></li>
</ul>
</section>
<section id="what-is-normal" class="slide level2">
<h2>What is normal?</h2>
<ul>
<li>Each normal form builds on those before</li>
<li>The primary normal forms are:</li>
</ul>
<dl>
<dt>Denormalized</dt>
<dd>
No normalization. Nested and redundant data is allowed
</dd>
<dt>First normal form (1NF)</dt>
<dd>
Each column is unique and has a single value. The table has a unique
primary key.
</dd>
<dt>Second normal form (2NF)</dt>
<dd>
Partial dependencies are removed (only necessary if compound primary
key)
</dd>
<dt>Third normal form (3NF)</dt>
<dd>
Each table contains fields only relevant to its primary key, and has no
transitive dependencies
</dd>
</dl>
</section>
<section id="denormalized" class="slide level2">
<h2>Denormalized</h2>
<div class="cols">
<div class="col">
<ul>
<li>APIs will commonly give denormalized data, since they tend to return
JSON type entries</li>
<li>Consider the entry to the right about a particular order</li>
</ul>
</div>
<div class="col" style="flex-grow:2">
<pre ><code class="json" style="max-height:1000px; font-size:.9em;">{ "OrderID": 100,
  "OrderItems": [
    {
      "sku": 1,
      "price": 10,
      "quantity": 1,
      "name": "Thingmajig"
    },
    {
      "sku": 2,
      "price": 25,
      "quantity": 2,
      "name": "Whatchamacalit"
    }],
  "CustomerID": 5,
  "CustomerName": "Jed Rembold",
  "OrderDate": "2022-11-09" }</code></pre>
</div>
</div>
</section>
<section id="initial-attempt" class="slide level2">
<h2>Initial Attempt</h2>
<table style="font-size:.9em">
<tr>
<th>
OrderID
</th>
<th style="width:35%">
OrderItems
</th>
<th>
CustomerID
</th>
<th>
CustomerName
</th>
<th>
OrderDate
</th>
</tr>
<tr>
<td>
100
</td>
<td>
<pre><code class='json' style='font-size:.5em'>
  [
    {
      "sku": 1,
      "price": 10,
      "quantity": 1,
      "name": "Thingmajig"
    },
    {
      "sku": 2,
      "price": 25,
      "quantity": 2,
      "name": "Whatchamacalit"
    }
  ]
    </code></pre>
</td>
<td>
5
</td>
<td>
Jed Rembold
</td>
<td>
2022-11-09
</td>
</tr>
</table>
</section>
<section id="st-normal-form" class="slide level2">
<h2>1st Normal Form</h2>
<div style="font-size: .8em">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 5%" />
<col style="width: 8%" />
<col style="width: 11%" />
<col style="width: 18%" />
<col style="width: 14%" />
<col style="width: 16%" />
<col style="width: 14%" />
</colgroup>
<thead>
<tr class="header">
<th>OrderID</th>
<th>Sku</th>
<th>Price</th>
<th>Quantity</th>
<th>ProductName</th>
<th>CustomerID</th>
<th>CustomerName</th>
<th>OrderDate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>100</td>
<td>1</td>
<td>50</td>
<td>1</td>
<td>Thingmajig</td>
<td>5</td>
<td>Jed Rembold</td>
<td>2022-11-09</td>
</tr>
<tr class="even">
<td>100</td>
<td>2</td>
<td>25</td>
<td>2</td>
<td>Whatchamacalit</td>
<td>5</td>
<td>Jed Rembold</td>
<td>2022-11-09</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="st-normal-form-pk" class="slide level2">
<h2>1st Normal Form (PK)</h2>
<div style="font-size: .7em">
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 10%" />
<col style="width: 5%" />
<col style="width: 7%" />
<col style="width: 10%" />
<col style="width: 16%" />
<col style="width: 12%" />
<col style="width: 14%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">OrderID</th>
<th style="text-align: center;">ItemNum</th>
<th style="text-align: center;">Sku</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Quantity</th>
<th style="text-align: left;">ProductName</th>
<th style="text-align: center;">CustomerID</th>
<th>CustomerName</th>
<th>OrderDate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">100</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">1</td>
<td style="text-align: left;">Thingmajig</td>
<td style="text-align: center;">5</td>
<td>Jed Rembold</td>
<td>2022-11-09</td>
</tr>
<tr class="even">
<td style="text-align: center;">100</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">25</td>
<td style="text-align: center;">2</td>
<td style="text-align: left;">Whatchamacalit</td>
<td style="text-align: center;">5</td>
<td>Jed Rembold</td>
<td>2022-11-09</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="evaluating-2nf" class="slide level2">
<h2>Evaluating 2NF</h2>
<ul>
<li>To be in second normal form, there can be no partial dependencies,
where columns depend on only one of the compound keys</li>
<li>Here though the last 3 columns all depend only on OrderID
<ul>
<li>Solution: Split to new tables!</li>
</ul></li>
</ul>
</section>
<section id="nd-normal-form" class="slide level2">
<h2>2nd Normal Form</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">OrderID</th>
<th style="text-align: center;">CustomerID</th>
<th>CustomerName</th>
<th>OrderDate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">100</td>
<td style="text-align: center;">5</td>
<td>Jed Rembold</td>
<td>2022-11-09</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">OrderID</th>
<th style="text-align: center;">ItemNum</th>
<th style="text-align: center;">Sku</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Quantity</th>
<th>ProductName</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">100</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">1</td>
<td>Thingmajig</td>
</tr>
<tr class="even">
<td style="text-align: center;">100</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">25</td>
<td style="text-align: center;">2</td>
<td>Whatchamacalit</td>
</tr>
</tbody>
</table>
</section>
<section id="evaluating-3nf" class="slide level2">
<h2>Evaluating 3NF</h2>
<ul>
<li>The third normal form prohibits transitive dependencies, where a
column depends on another (that depends on the primary key), instead of
depending directly on the primary key</li>
<li>Here we have 2! One in each table:
<ul>
<li><code class="pgsql">ProductName</code> depends on
<code class="pgsql">Sku</code></li>
<li><code class="pgsql">CustomerName</code> depends on
<code class="pgsql">CustomerID</code></li>
</ul></li>
<li>Solution? More tables!</li>
</ul>
</section>
<section id="rd-normal-form" class="slide level2">
<h2>3rd Normal Form</h2>
<div style="font-size:.9em">
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Sku</th>
<th>ProductName</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td>Thingmajig</td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td>Whatchamacalit</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">CustomerID</th>
<th>CustomerName</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">5</td>
<td>Jed Rembold</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">OrderID</th>
<th style="text-align: center;">ItemNum</th>
<th style="text-align: center;">Sku</th>
<th style="text-align: center;">Price</th>
<th style="text-align: center;">Quantity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">100</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">50</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: center;">100</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">25</td>
<td style="text-align: center;">2</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">OrderID</th>
<th style="text-align: center;">CustomerID</th>
<th>OrderDate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">100</td>
<td style="text-align: center;">5</td>
<td>2022-11-09</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="visually" class="slide level2">
<h2>Visually</h2>
<p><img data-src="../images/normal_forms_example.png"
style="width:100.0%" /></p>
</section>
<section id="beyond" class="slide level2">
<h2>Beyond</h2>
<ul>
<li>Other normal forms exist (up to 6NF in the Boyce-Codd system)</li>
<li>Most people only care about the first 3 to get data in a
“normalized” state</li>
<li>Unless you have specific performance reasons for wanting otherwise,
you really should strive for normalized tables in your relational
database, as they make maintaining, adding, updating, and adjusting your
database and tables much easier</li>
</ul>
</section>
<section id="activity" class="slide level2">
<h2>Activity</h2>
<div class="smaller">
<ul>
<li><p>Think back to the Spotify modeling that we were playing around
with last week</p></li>
<li><p>Suppose you have the following information you need to store for
each track:</p>
<table>
<thead>
<tr class="header">
<th>Info</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Track Name</td>
<td>The name of the track</td>
</tr>
<tr class="even">
<td>Artists</td>
<td>Comma separated list of contributing artists</td>
</tr>
<tr class="odd">
<td>Album</td>
<td>The album this specific track appears on</td>
</tr>
<tr class="even">
<td>Duration</td>
<td>The duration of the track in seconds</td>
</tr>
<tr class="odd">
<td>Genre</td>
<td>The general genre of the track</td>
</tr>
<tr class="even">
<td>Track Num</td>
<td>The placement of this track on the album</td>
</tr>
</tbody>
</table></li>
<li><p>Your task is to model this information into purely tables of
3NF</p></li>
</ul>
</div>
</section>
<section id="activity-example-data" class="slide level2">
<h2>Activity Example Data</h2>
<ul>
<li>Sometimes it helps to have some example data to look at:</li>
</ul>
<div class="smaller">
<table>
<colgroup>
<col style="width: 22%" />
<col style="width: 19%" />
<col style="width: 29%" />
<col style="width: 10%" />
<col style="width: 13%" />
<col style="width: 6%" />
</colgroup>
<thead>
<tr class="header">
<th>TName</th>
<th>Artists</th>
<th>Album</th>
<th>Duration</th>
<th>Genre</th>
<th>TNum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Don’t Stop Believin’</td>
<td>Journey</td>
<td>Greatest Hits</td>
<td>249</td>
<td>Rock</td>
<td>2</td>
</tr>
<tr class="even">
<td>Don’t Stop Believin’</td>
<td>Journey</td>
<td>Escape</td>
<td>251</td>
<td>Rock</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Fifteen</td>
<td>Taylor Swift</td>
<td>Fearless (Taylor’s Version)</td>
<td>294</td>
<td>Country Pop</td>
<td>2</td>
</tr>
<tr class="even">
<td>Under Pressure</td>
<td>Queen,David Bowie</td>
<td>Greatest Hits</td>
<td>238</td>
<td>Rock</td>
<td>7</td>
</tr>
</tbody>
</table>
</div>
</section></section>
<section>
<section id="indexing" class="title-slide slide level1">
<h1>Indexing</h1>

</section>
<section id="consulting-an-index" class="slide level2">
<h2>Consulting an Index</h2>
<ul>
<li>Like in a book, an <em>index</em> is a precomputed guide to help
find things faster</li>
<li>We can construct similar precomputed guides for certain columns in
SQL to also help find things faster!</li>
<li>There are several different types of indexes
<ul>
<li>By default, the assigned index type is a B-Tree index in Postgres
<ul>
<li>B-Tree stands for <em>balanced tree</em> and work best for
<em>orderable</em> type data</li>
</ul></li>
<li>Index types like <em>Generalized Inverted Index</em> (GIN) and
<em>Generalized Search Tree</em> (GiST) will be discussed later as they
come up</li>
<li>Different columns in the same table can be indexed with different
methods</li>
</ul></li>
</ul>
</section>
<section id="climbing-a-b-tree" class="slide level2">
<h2>Climbing a B-Tree</h2>
<figure>
<img data-src="../images/b-tree-loopup.png" style="width:80.0%"
alt="Showing the structure and looking up a key in a B-Tree" />
<figcaption aria-hidden="true">Showing the structure and looking up a
key in a B-Tree</figcaption>
</figure>
</section>
<section id="creating-indexes" class="slide level2">
<h2>Creating Indexes</h2>
<ul>
<li><p>Postgres will automatically index any column that is a primary
key or which has the <code class="pgsql">UNIQUE</code>
constraint</p></li>
<li><p>You can choose to set up indexes on other columns as well, but do
so outside of the table creation</p>
<pre ><code class="pgsql" style="font-size:1em">CREATE INDEX |||index name||| ON |||table name||| (|||column|||);</code></pre></li>
<li><p>If you decide you want to remove an index, you do so using the
index name:</p>
<pre ><code class="pgsql" style="font-size:1em">DROP INDEX |||index name|||;</code></pre></li>
</ul>
</section>
<section id="benchmarking" class="slide level2">
<h2>Benchmarking</h2>
<ul>
<li><p>How can we objectively test this?</p>
<ul>
<li>Postgres has the <code class="pgsql">EXPLAIN</code> keyword to give
you information about what the database is doing in the background</li>
<li>Using <code class="pgsql">EXPLAIN ANALYZE</code> will also give you
timing information about how long it took a query to run</li>
</ul></li>
<li><p><code class="pgsql">EXPLAIN</code> always comes at the start of
your query</p>
<pre ><code class="pgsql">EXPLAIN ANALYZE
SELECT * FROM |||table name|||
WHERE |||condition|||;</code></pre></li>
<li><p>Other SQL variants have their own versions, but most have some
method of getting information back about execution time or what is being
done under the hood</p></li>
</ul>
</section>
<section id="benchmarking-caveats" class="slide level2">
<h2>Benchmarking Caveats</h2>
<ul>
<li><code class="pgsql">EXPLAIN ANALYZE</code> reports to you the time
it took the server to process the query, not necessarily the time it
took your client to finish getting and rendering the response!
<ul>
<li>Especially for queries that return a huge number of rows, you might
see a significant difference</li>
</ul></li>
<li>Indexes are optimized for certain types of operations. Just because
you index a column doesn’t mean that Postgres will <strong>use</strong>
that index if you are doing an incompatible operation!
<ul>
<li>Check more than just the timings from
<code class="pgsql">EXPLAIN ANALYZE</code>
<ul>
<li>See comments about Bitmaps and Heaps? Then the index was used.</li>
<li>See comments about Parallel or Seq scans? Then the index was not
used.</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="costs" class="slide level2">
<h2>Costs</h2>
<ul>
<li>Indexes always have a cost associated with them, both in initial
setup and in every time new data is added to the column
<ul>
<li>Also, they are stored information, so they can also inflate your
database size</li>
</ul></li>
<li>Consider indexing only those columns that receive the heaviest of
use in filters or in joining</li>
<li>You never need to worry about indexing primary keys or unique
columns, as those are done automatically
<ul>
<li>Indexing of <em>foreign keys</em> though is not automatic, and might
be a good idea for large datasets</li>
</ul></li>
<li>When in doubt, <strong>benchmark</strong> your queries before and
after adding an index to see if you are really gaining much from
it!</li>
</ul>
</section>
<section id="benchmarking-activity" class="slide level2">
<h2>Benchmarking Activity</h2>
<ul>
<li>Most likely, you already (still) have the NYC Taxi Rides data on
your computer</li>
<li>Benchmark that data set under three different queries, for each
getting a time both before creating an index and then after creating an
index over the filtered column
<ul>
<li>Select all the columns for the row where the ride id = 56789</li>
<li>Select all the columns for the rows where the total amount charged
was greater than $40</li>
<li>Select all the columns for the rows where the total amount charged
was greater than $10</li>
</ul></li>
<li>Enter your values into the shared spreadsheet <a
href="https://docs.google.com/spreadsheets/d/1WLhoEYzDR3I6LZqeZZ-FM0lmdiTKde_Ygwk1f5_sQRk/edit?usp=sharing">here</a>
(Just choose an unused trial number)</li>
</ul>
</section></section>
<section>
<section id="break" class="title-slide slide level1">
<h1>Break!</h1>

</section>
<section id="break-time" class="slide level2">
<h2>Break Time!</h2>
<p><img data-src="../images/nomming_catepillar.png" /></p>
</section></section>
<section>
<section id="grouping" class="title-slide slide level1">
<h1>Grouping</h1>

</section>
<section id="birds-of-a-feather" class="slide level2">
<h2>Birds of a Feather</h2>
<ul>
<li><p>It is frequently the case that values in a particular table
column all belong to a smaller subset of categories or options</p>
<ul>
<li>Think months of the year or political parties</li>
</ul></li>
<li><p>With current methods, if you want to compare some sort of
aggregate between those categories or options, you need to do it in
multiple queries:</p>
<div class="cols">
<div class="col">
<pre ><code class="pgsql">SELECT AVG(age)
FROM voters
WHERE party = 'D'</code></pre>
</div>
<div class="col">
<pre ><code class="pgsql">SELECT AVG(age)
FROM voters
WHERE party = 'R'</code></pre>
</div>
</div></li>
<li><p>This rapidly becomes intractable if you want to compare across
many categories</p></li>
</ul>
</section>
<section id="the-fix" class="slide level2">
<h2>The Fix</h2>
<div class="smaller">
<ul>
<li>SQL has one last fundamental trick up its sleeve with the
<code class="pgsql">GROUP BY</code> command</li>
<li><code class="pgsql">GROUP BY</code> gathers together all rows with
matching values from a particular column
<ul>
<li>By itself, this is basically the same as running
<code class="pgsql">DISTINCT</code> on a column</li>
<li>Note that once you make a grouping, you can only select entire
columns that are a part of the grouping</li>
</ul>
<pre ><code class="pgsql">SELECT |||grouped column|||
FROM |||table name|||
GROUP BY |||grouped column|||;</code></pre></li>
<li>Can visualize as if many smaller tables were created, one for each
grouping, which are then joined back together with each table
contributing one row</li>
</ul>
</div>
</section>
<section id="aggregating-groups" class="slide level2">
<h2>Aggregating Groups</h2>
<ul>
<li><p>Groups by themselves are not that useful, since we already had
<code class="pgsql">DISTINCT</code></p></li>
<li><p>The prime use-case of <code class="pgsql">GROUP BY</code> is to
be able to run aggregates across <em>all</em> potential groups
<em>simultaneously</em> for comparison</p>
<pre ><code class="pgsql">SELECT 
  |||grouped column|||, 
  min(|||some other column|||), 
  avg(|||some other column|||)
FROM |||table name|||
GROUP BY |||grouped column|||;</code></pre></li>
<li><p>Causes any aggregate function to just aggregate over the smaller,
group tables</p></li>
</ul>
</section>
<section id="group-example" class="slide level2">
<h2>Group Example</h2>
<p>Looking back at the cereal table, how can we answer:</p>
<ul>
<li>Which manufacturer sells the most sugar-laden cereal?</li>
<li>What shelf has the most cereals placed on it? What about the
greatest calorie average?</li>
</ul>
</section>
<section id="multiple-groups" class="slide level2">
<h2>MULTIPLE GROUPS</h2>
<ul>
<li>Like with <code class="pgsql">DISTINCT</code> or
<code class="pgsql">UNIQUE</code>, you can group by multiple
columns</li>
<li>Essentially splits the sub-tables into even smaller tables, one for
each combination</li>
</ul>
<pre ><code class="pgsql">SELECT 
  |||grouped col1|||,
  |||grouped col2|||,
  min(|||other col|||), 
  avg(|||other col|||)
FROM |||table|||
GROUP BY |||grouped col1|||, |||grouped col2|||</code></pre>
</section>
<section id="have-or-have-not" class="slide level2">
<h2>HAVE or HAVE NOT</h2>
<ul>
<li>You can not filter based on aggregates using
<code class="pgsql">WHERE</code>
<ul>
<li><code class="pgsql">WHERE</code> actions happen before any
aggregates can be computed</li>
</ul></li>
<li>If you want to filter your grouped results, you need to use
<code class="pgsql">HAVING</code>
<ul>
<li><code class="pgsql">HAVING</code> filters take place
<strong>after</strong> groups and aggregates have been computed</li>
</ul></li>
</ul>
<pre ><code class="pgsql">SELECT 
  |||grouped col|||
  min(|||other col|||), 
  avg(|||other col|||)
FROM |||table|||
GROUP BY |||grouped col|||
HAVING min(|||other col|||) > 50;</code></pre>
</section>
<section id="server-ordering" class="slide level2">
<h2>Server Ordering</h2>
<p><img data-src="../images/query_flowchart.png"
style="width:80.0%" /></p>
<!-- for next class
## SHOWDOWN TIME!
- Teams to be announced on next slide
- Whoever want to be in charge of submitting your answer can change your polling name to a fun team name :)
- Only one computer can be used by the pair of you at a time
  - We'll be using the superhero dataset from HW4
  - 4 rounds: each round switch who is typing
- You'll have 5 minutes to answer each question. Starting to 2 minutes you can submit a _single_ answer
  - Submitting an answer sooner gets you more points!


## Showdown Teams
- Frances and Miles
- Cristian, Jill and Oscar
- Micah and Alaina
- Aaryan and Phil
-->
</section></section>
<section>
<section id="whos-son" class="title-slide slide level1">
<h1>Who’s Son?</h1>

</section>
<section id="json-in-postgres" class="slide level2">
<h2>JSON in Postgres</h2>
<ul>
<li>One data type that we haven’t discussed yet in Postgres is
<code class="pgsql">json</code></li>
<li>Postgres actually support two <code class="pgsql">json</code> types:
<ul>
<li><code class="pgsql">json</code>: stores data as text
<ul>
<li>Slower to process, but maintains whitespace and key orderings</li>
</ul></li>
<li><code class="pgsql">jsonb</code>: stores data in a binary format
<ul>
<li>Slightly slow to insert, but much faster to process</li>
<li>Can have indexes defined</li>
</ul></li>
</ul></li>
<li>In general, <code class="pgsql">jsonb</code> is probably preferable
unless you really need what the base <code class="pgsql">json</code>
type offers</li>
</ul>
</section>
<section id="populating-json-tables" class="slide level2">
<h2>Populating JSON Tables</h2>
<ul>
<li><p>JSON is frequently given with the outermost type being a list,
and then each record inside separated by commas</p></li>
<li><p>Postgres will <strong>not</strong> innately be able to import
this type of document</p></li>
<li><p>Instead, Postgres <code class="pgsql">COPY</code> works best when
the JSON is a newline delimited JSON file (sometimes called jsonlines),
where each new record is on a single line, and there is no surrounding
<code class="pgsql">[]</code></p>
<pre ><code class="pgsql">COPY |||table name|||
FROM |||your newline json file|||.json</code></pre></li>
<li><p>Want to follow along? A jsonlines file is <a
href="../activity_data/jsondemo.jsonlines">here</a>!</p></li>
</ul>
</section>
<section id="json-selections" class="slide level2">
<h2>JSON Selections</h2>
<ul>
<li><p>You can drill down and select specific values from
<code class="pgsql">json</code> or <code class="pgsql">jsonb</code>
types using two different syntaxes:</p>
<ul>
<li><code class="pgsql">raw_json -> 'key'/index</code> where:
<ul>
<li>key is a string for key-value pairs</li>
<li>index is an integer for arrays (0-based!)</li>
</ul></li>
<li><code class="pgsql">raw_json['key'/index]</code> with the same
conventions as above</li>
</ul></li>
<li><p>These can be “chained” to “drill down” to the desired info</p>
<pre ><code class="postgresql">raw_json -> 'siblings' -> 0 -> 'name'</code></pre></li>
<li><p>These selections return more
<code class="pgsql">json</code>/<code class="pgsql">jsonb</code>
objects! Convert as needed</p></li>
<li><p>Using <code class="pgsql">->></code> will instead return a
<code class="pgsql">TEXT</code> type object</p></li>
</ul>
</section>
<section id="json-existence" class="slide level2">
<h2>JSON Existence</h2>
<ul>
<li><p>Recall that JSON does not enforce a strict schema, so some
entries may have keys or values that others are missing</p></li>
<li><p>It can thus be useful to check for the existence of certain keys
or values</p></li>
<li><p>You can check if an entire chunk is contained within a block of
JSON using <code class="pgsql">@></code>:</p>
<pre ><code class="pgsql">raw_json @> |||sub-snippet of json|||</code></pre></li>
<li><p>You can also check if a key or value shows up in the <strong>top
level</strong> of the JSON block using <code class="pgsql">?</code>:</p>
<pre ><code class="pgsql">raw_json ? |||top-level key|||</code></pre></li>
</ul>
</section>
<section id="json-indexes" class="slide level2">
<h2>JSON Indexes</h2>
<ul>
<li><p>While you can create a default B-tree index for
<code class="pgsql">jsonb</code> columns, they generally wouldn’t be
very useful</p></li>
<li><p>Instead, we can use a different type of index called a
<em>generalized inverted index</em>, or GIN</p></li>
<li><p>This type of index works much better when the data is comprised
of nested composite items (we’ll see it again when we look at text
searching)</p></li>
<li><p>Just add <code class="pgsql">USING GIN</code> to your normal
command to make an index</p>
<pre ><code class="pgsql">CREATE INDEX |||my index||| ON |||mytable||| USING GIN (|||colname|||);</code></pre></li>
</ul>
</section></section>
<section>
<section id="a-question-of-timing" class="title-slide slide level1">
<h1>A Question of Timing</h1>

</section>
<section id="date-time-reminders" class="slide level2">
<h2>Date-Time Reminders</h2>
<ul>
<li>We have about 4 current date or time related data types</li>
<li>Date time types:
<ul>
<li><code class="pgsql">DATE</code>: holds a single individual day</li>
<li><code class="pgsql">TIME</code>: holds a single individual time</li>
<li><code class="pgsql">TIMESTAMP</code> or variants with
<code class="pgsql">TIMESTAMPTZ</code>: holds a combination of date and
time, along with a potential time zone</li>
</ul></li>
<li>Interval types:
<ul>
<li><code class="pgsql">INTERVAL</code>: holds a duration of time</li>
</ul></li>
</ul>
</section>
<section id="extracting-pieces" class="slide level2">
<h2>Extracting Pieces</h2>
<ul>
<li>Having all the information in one value is convenient, but sometimes
you only need pieces
<ul>
<li>The hour from the time, or the month from the date</li>
</ul></li>
<li>These can be particularly important with aggregates!</li>
<li>Two methods to extract pieces of any datetime or interval type:
<ul>
<li>SQL standard:
<code class="pgsql">extract( part FROM |||datetime_value||| )</code></li>
<li>Postgres specific:
<code class="pgsql">date_part( |||part|||, |||datetime_value||| )</code></li>
</ul></li>
<li>Both will return a <code class="pgsql">DOUBLE PRECISION</code> value
of whatever part was requested</li>
</ul>
</section>
<section id="parts-to-extract" class="slide level2">
<h2>Parts To Extract</h2>
<ul>
<li>You have a wide variety of what you can extract</li>
</ul>
<div style="font-size:.60em">
<div class="cols">
<div class="col">
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 81%" />
</colgroup>
<thead>
<tr class="header">
<th>text</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>century</td>
<td>What century the date is in. 1st century starts 0001-01-01<span
class="orange">★</span></td>
</tr>
<tr class="even">
<td>day</td>
<td>What day of the month</td>
</tr>
<tr class="odd">
<td>decade</td>
<td>The year divided by 10</td>
</tr>
<tr class="even">
<td>dow</td>
<td>The day of the week (0-6, starting with Sunday)</td>
</tr>
<tr class="odd">
<td>doy</td>
<td>The day of the year</td>
</tr>
<tr class="even">
<td>epoch</td>
<td>Number of seconds since 1970-01-01</td>
</tr>
<tr class="odd">
<td>hour</td>
<td>The current hour (0-23)</td>
</tr>
<tr class="even">
<td>microseconds</td>
<td>The number of microseconds</td>
</tr>
</tbody>
</table>
</div>
<div class="col">
<table>
<thead>
<tr class="header">
<th>text</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>milliseconds</td>
<td>The number of milliseconds</td>
</tr>
<tr class="even">
<td>minute</td>
<td>The minute</td>
</tr>
<tr class="odd">
<td>month</td>
<td>The month (1-12)</td>
</tr>
<tr class="even">
<td>quarter</td>
<td>What quarter of the year (1-4)</td>
</tr>
<tr class="odd">
<td>second</td>
<td>The number of seconds</td>
</tr>
<tr class="even">
<td>timezone</td>
<td>The timezone offset in seconds</td>
</tr>
<tr class="odd">
<td>timezone_hour</td>
<td>The timezone offset in hours</td>
</tr>
<tr class="even">
<td>week</td>
<td>What week of the year. ISO weeks start on Monday</td>
</tr>
<tr class="odd">
<td>year</td>
<td>The year</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<hr>
<div style="font-size:.5em">
<p><span class="orange">★</span> – If you disagree with this, please
write your complaint to: Pope, Cathedral Saint-Peter of Roma,
Vatican.</p>
</div>
</section>
<section id="reversing-it" class="slide level2">
<h2>Reversing it</h2>
<div style="font-size:.9em">
<ul>
<li>Often times existing data sets have already separated out different
aspects of the date or time
<ul>
<li>Year, month, and day might be in different columns for example</li>
</ul></li>
<li>It can be useful to “stitch” these together into an actual datetime
type for further use.</li>
<li>Postgres gives you a handful of functions to do so:
<ul>
<li><code class="pgsql">make_date( |||year|||, |||month|||, |||day|||)</code>:
Returns a new <code class="pgsql">DATE</code> type value</li>
<li><code class="pgsql">make_time( |||hour|||, |||minute|||, |||seconds||| )</code>:
Returns a new <code class="pgsql">TIME</code> type value (with no
timezone)</li>
<li><code class="pgsql">make_timestamptz(|||year|||,|||month|||,|||day|||,|||hour|||,|||minute|||,|||second|||,|||time zone|||)</code>:
Returns a new <code class="pgsql">TIMESTAMPTZ</code> type value</li>
<li><code class="pgsql">make_timestamp</code> and
<code class="pgsql">make_interval</code> also exist</li>
</ul></li>
</ul>
</div>
</section>
<section id="aging-well" class="slide level2">
<h2>Aging well</h2>
<ul>
<li>Subtracting two <code class="pgsql">DATE</code> type values will
give just an <code class="pgsql">INT</code> (in days)</li>
<li>Subtracting two <code class="pgsql">TIMESTAMP</code> type values
will give an <code class="pgsql">INTERVAL</code>, with the biggest
“unit” in days</li>
<li>Using Postgres’s <code class="pgsql">age()</code> function can
smooth over both and give units larger than days
<ul>
<li><code class="pgsql">age( datetime1, datetime2 )</code>: Subtracts
datetime2 from datetime1</li>
</ul></li>
<li>This can <strong>still</strong> give you awkward interval units at
times though, so also consider using
<code class="pgsql">justify_interval( interval )</code>, which breaks
intervals into divisions that don’t exceed a categories max
<ul>
<li>Hours would always be between 0 and 23 for instance, or months
between 1 and 12</li>
<li>Especially if you want to extract a particular part, this is highly
recommended</li>
</ul></li>
</ul>
</section>
<section id="what-time-is-it" class="slide level2">
<h2>What time is it?</h2>
<ul>
<li>Standard SQL also provides constants for grabbing the current system
time and date</li>
</ul>
<div style="font-size:.8em">
<table>
<colgroup>
<col style="width: 40%" />
<col style="width: 59%" />
</colgroup>
<thead>
<tr class="header">
<th>function</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code class="pgsql">current_date</code></td>
<td>Returns the current date</td>
</tr>
<tr class="even">
<td><code class="pgsql">current_time</code></td>
<td>Returns the current time with timezone</td>
</tr>
<tr class="odd">
<td><code class="pgsql">localtime</code></td>
<td>Returns the current time without timezone</td>
</tr>
<tr class="even">
<td><code class="pgsql">current_timestamp</code><span
class="orange">★</span></td>
<td>Returns the current date and time with timezone</td>
</tr>
<tr class="odd">
<td><code class="pgsql">localtimestamp</code></td>
<td>Returns the current date and time without timezone</td>
</tr>
</tbody>
</table>
</div>
<hr>
<p><span class="orange">★</span> – Postgres also offers the shorter
<code class="pgsql">now()</code> <em>function</em> to do the same
thing</p>
<!--## Current vs Clock-->
<!--- Any query using `current_timestamp` has it computed once at the start of a query-->
<p><!--- This is frequently desired for logging, so that you just get 1 consistent time for any records added from a single query-->
<!--- If you **want** record-by-record time keeping, you should use `clock_timestamp()` instead, which will work the same way but be updated before every value written to the table--></p>
</section>
<section id="time-zones" class="slide level2">
<h2>Time Zones</h2>
<ul>
<li>Dealing with time zones can be a headache, and it is a very nice
feature that Postgres can work with them smoothly</li>
<li>By default, Postgres will <em>display</em> any timestamp with a time
zone with the time as you would measure it in your current system
timezone</li>
<li>What is your current system timezone?
<ul>
<li><code class="pgsql">SHOW timezone;</code></li>
</ul></li>
<li>Getting general information about timezones:
<ul>
<li>Getting abbreviations:
<ul>
<li><code class="pgsql">SELECT * FROM pg_timezone_abbrevs;</code></li>
</ul></li>
<li>Getting full names:
<ul>
<li><code class="pgsql">SELECT * FROM pg_timezone_names;</code></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="teleportation" class="slide level2">
<h2>Teleportation</h2>
<ul>
<li>It can sometimes be useful to switch your “current” time zone
<ul>
<li>Maybe it is easier to compare times to someone else living in that
time zone</li>
</ul></li>
<li>Several methods to make the switch:
<ul>
<li><p>Change your <code class="pgsql">postgressql.conf</code> file,
which controls your Postgres server. Only recommended if you have
permanently moved elsewhere and the database time zone has not updated
appropriately.</p></li>
<li><p>Set future queries in a single session to be from a new
timezone:</p>
<p><code class="pgsql">SET timezone TO time_zone_name_or_abbrv;</code></p>
<ul>
<li>This will also adjust what values your
<code class="pgsql">localtime</code> or
<code class="pgsql">localtimestamp</code> report!</li>
</ul></li>
<li><p>Transform a single query to be reported in a different time
zone:</p>
<pre ><code class="pgsql">SELECT |||datetime column||| AT TIME ZONE |||tz name or abbr|||
FROM |||table name|||;</code></pre></li>
</ul></li>
</ul>
</section>
<section id="activity-1" class="slide level2">
<h2>Activity</h2>
<ul>
<li>Using the taxi rides dataset, see if you can:
<ul>
<li>Compute the number of rides given each hour of the day</li>
<li>Compute the average cost of rides over each day of the month</li>
<li>Compute the median cost of rides over each day of the week</li>
<li>Compute the average duration of each ride over each hour of the
day</li>
</ul></li>
</ul>
</section></section>
    </div>
  </div>

  <script src="../html_srcs/revealjs/dist/reveal.js"></script>

  // reveal.js plugins
  <script src="../html_srcs/revealjs/plugin/notes/notes.js"></script>
  <script src="../html_srcs/revealjs/plugin/search/search.js"></script>
  <script src="../html_srcs/revealjs/plugin/zoom/zoom.js"></script>
  // Added plugins
  <script src="../html_srcs/revealjs/../plugin/chart/Chart.min.js"></script>
  <script src="../html_srcs/revealjs/../plugin/chart/plugin.js"></script>
  <script src="../html_srcs/revealjs/../plugin/chalkboard/plugin.js"></script>
  <script src="../html_srcs/revealjs/../plugin/menu/menu.js"></script>
  <script src="../html_srcs/revealjs/../other_plugins/reveal.js-d3/reveald3.js"></script>
  <script src="../html_srcs/revealjs/plugin/math/math.js"></script>
  <script src="../html_srcs/revealjs/plugin/highlight/highlight.js"></script>
  <script src="../html_srcs/revealjs/../js/mypgsql.js"></script>
  <script src="../html_srcs/revealjs/../js/mybash.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
		//autoAnimateEasing: 'ease-in',
		//autoAnimateDuration: 1.0,
		//autoAnimateUnmatched: false,
        pdfSeparateFragments: false,
        // Display controls in the bottom right corner
        controls: true,
        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,
        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',
        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',
        // Display a presentation progress bar
        progress: true,
        // Display the page number of the current slide
        slideNumber: true,
        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,
        // Push each slide change to the browser history
        history: true,
        // Enable keyboard shortcuts for navigation
        keyboard: true,
        // Enable the slide overview mode
        overview: true,
        // Vertical centering of slides
        center: false,
        // Enables touch navigation on devices with touch input
        touch: true,
        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',
        // Turns fragments on and off globally
        fragments: true,
        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: true,
        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,
        // Global override for autoplaying embedded media (video/audio/iframe)
        // - null: Media will only autoplay if data-autoplay is present
        // - true: All media will autoplay, regardless of individual setting
        // - false: No media will autoplay, regardless of individual setting
        autoPlayMedia: null,
        // Global override for preloading lazy-loaded iframes
        // - null: Iframes with data-src AND data-preload will be loaded when within
        //   the viewDistance, iframes with only data-src will be loaded when visible
        // - true: All iframes with data-src will be loaded when within the viewDistance
        // - false: All iframes with data-src will be loaded only when visible
        preloadIframes: null,
        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,
        // Stop auto-sliding after user input
        autoSlideStoppable: true,
        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,
        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,
        // Hide cursor if inactive
        hideInactiveCursor: true,
        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,
        // Transition style
        transition: 'slide', // none/fade/slide/convex/concave/zoom
        // Transition speed
        transitionSpeed: 'default', // default/fast/slow
        // Transition style for full page slide backgrounds
        backgroundTransition: 'fade', // none/fade/slide/convex/concave/zoom
        // Number of slides away from the current that are visible
        viewDistance: 3,
        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,
        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1920,
        height: 1080,
        // The display mode that will be used to show slides
        display: 'block',
		math: {
		  <!--mathjax: '../html_srcs/reveal.js/plugin/math/mathjax/tex-mml-chtml.js',-->
		  <!--config: 'tex-mml-chtml',-->
		  <!--tex2jax: {-->
			<!--inlineMath: [['\\(','\\)']],-->
			<!--displayMath: [['\\[','\\]']],-->
			<!--balanceBraces: true,-->
			<!--processEscapes: false,-->
			<!--processRefs: true,-->
			<!--processEnvironments: true,-->
			<!--preview: 'TeX',-->
			<!--skipTags: ['script','noscript','style','textarea','pre','code'],-->
			<!--ignoreClass: 'tex2jax_ignore',-->
			<!--processClass: 'tex2jax_process'-->
		  <!--},-->
		  CommonHTML: {scale: 80},
		},
	reveald3: {
			runLastState: true, // true/false, default: true
			onSlideChangedDelay: 200,
			mapPath: false, // true / false / "spefific/path/as/string", default: false
			tryFallbackURL: true, // true/false, default false
			disableCheckFile: false, //default false
		 },
          highlight: {
            beforeHighlight: hljs => {
              hljs.registerLanguage("pgsql", function(hljs) {
                console.log(mypgsqldef);
                return mypgsqldef(hljs); 
              });
              hljs.registerLanguage("bash", function(hljs) {
                console.log(mybashdef);
                return mybashdef(hljs); 
              });
              console.log(hljs);
              document.querySelectorAll('code').forEach((block) => {
                hljs.highlightElement(block);
            });
            }
          },

        // reveal.js plugins
        plugins: [
		  RevealMath,
          RevealHighlight,
          RevealNotes,
          RevealSearch,
          RevealZoom,
		  RevealChart,
		  RevealChalkboard,
          RevealMenu,
          Reveald3,
        ],
		chalkboard: {
          boardmarkerWidth: 4,
          chalkWidth: 7,
          theme: "whiteboard",
          boardmarkers : [
                  { color: 'rgba(46,52,64,1)',    cursor: 'url(' + path + 'img/boardmarker-black.png), auto'},
                  { color: 'rgba(94,129,172,1)',  cursor: 'url(' + path + 'img/boardmarker-blue.png), auto'},
                  { color: 'rgba(191,97,106,1)',  cursor: 'url(' + path + 'img/boardmarker-red.png), auto'},
                  { color: 'rgba(163,190,140,1)', cursor: 'url(' + path + 'img/boardmarker-green.png), auto'},
                  { color: 'rgba(208,135,112,1)', cursor: 'url(' + path + 'img/boardmarker-orange.png), auto'},
                  { color: 'rgba(180,142,173,1)', cursor: 'url(' + path + 'img/boardmarker-purple.png), auto'},
                  { color: 'rgba(235,203,139,1)', cursor: 'url(' + path + 'img/boardmarker-yellow.png), auto'}
          ],
          chalks: [
                  { color: 'rgba(216,222,223,0.5)',cursor: 'url(' + path + 'img/chalk-white.png), auto'},
                  { color: 'rgba(94,129,172,0.5)', cursor: 'url(' + path + 'img/chalk-blue.png), auto'},
                  { color: 'rgba(191,97,106,0.5)', cursor: 'url(' + path + 'img/chalk-red.png), auto'},
                  { color: 'rgba(163,190,140,0.5)',cursor: 'url(' + path + 'img/chalk-green.png), auto'},
                  { color: 'rgba(208,135,112,0.5)',cursor: 'url(' + path + 'img/chalk-orange.png), auto'},
                  { color: 'rgba(180,142,173,0.5)',cursor: 'url(' + path + 'img/chalk-purple.png), auto'},
                  { color: 'rgba(235,203,139,0.5)',cursor: 'url(' + path + 'img/chalk-yellow.png), auto'}
          ]
		},
		dependencies: [
            // { src: "../html_srcs/revealjs/plugin/title-footer/title-footer.js", async: true, callback: function() { title_footer.initialize({css:"../html_srcs/revealjs/plugin/title-footer/title-footer.css"}); } },
            //{ src: "../html_srcs/revealjs/plugin/d3/reveald3.js" },
		],
      });
    </script>
    <script>
    // This is admitedly a very hacky way to achieve my pseudo code highlighting, but it works?
      function remove_bars() {
        var pseudoBlocks = document.getElementsByClassName("hljs-pseudo");
        console.log(pseudoBlocks);
        for ( var i = 0; i < pseudoBlocks.length; i++) {
          pseudoBlocks[i].innerHTML = pseudoBlocks[i].innerHTML.replaceAll("\|\|\|", "");
        }
        }
      // omg this is even more hacky now, but I need this to run after hljs has done its thing
      setTimeout(remove_bars, 100);
    </script>
    </body>
</html>
